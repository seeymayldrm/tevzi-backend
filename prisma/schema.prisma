generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  SUPERVISOR
}

enum AttendanceType {
  IN
  OUT
}

model User {
  id        Int       @id @default(autoincrement())
  username  String    @unique
  password  String
  role      Role      @default(SUPERVISOR)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Personnel {
  id          Int             @id @default(autoincrement())
  fullName    String
  department  String?
  title       String?
  isActive    Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  cards       NFCCard[]
  assignments Assignment[]
  attendance  AttendanceLog[]
}

model NFCCard {
  id          Int          @id @default(autoincrement())
  uid         String       @unique
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  personnel   Personnel    @relation(fields: [personnelId], references: [id])
  personnelId Int

  attendanceLogs AttendanceLog[]   // <-- BUNU EKLÄ°YORUZ

  @@index([uid])
}


model Station {
  id          Int          @id @default(autoincrement())
  name        String
  code        String       @unique
  department  String?
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  assignments Assignment[]
}

model Shift {
  id          Int          @id @default(autoincrement())
  name        String
  code        String       @unique
  startTime   String       // "08:00"
  endTime     String       // "16:00"
  assignments Assignment[]
}

model Assignment {
  id          Int        @id @default(autoincrement())
  date        DateTime   // sadece gÃ¼nÃ¼ kullanacaÄŸÄ±z
  shift       Shift      @relation(fields: [shiftId], references: [id])
  shiftId     Int
  station     Station    @relation(fields: [stationId], references: [id])
  stationId   Int
  personnel   Personnel  @relation(fields: [personnelId], references: [id])
  personnelId Int

  // ðŸ”½ FORMDA GÄ°RDÄ°ÄžÄ°N SAATLER ARTIK BURAYA YAZILACAK
  startTime   String?    // Ã¶rn: "15:00"
  endTime     String?    // Ã¶rn: "18:00"

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@unique([date, shiftId, stationId, personnelId])
  @@index([date, shiftId, stationId])
}

model AttendanceLog {
  id          Int             @id @default(autoincrement())
  uid         String
  type        AttendanceType
  scannedAt   DateTime        @default(now())
  source      String?
  personnel   Personnel?      @relation(fields: [personnelId], references: [id])
  personnelId Int?
  card        NFCCard?        @relation(fields: [cardId], references: [id])
  cardId      Int?

  @@index([uid])
  @@index([scannedAt])
}
